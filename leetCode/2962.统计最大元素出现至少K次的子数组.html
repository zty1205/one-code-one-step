<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2962. 统计最大元素出现至少 K 次的子数组</title>
  </head>
  <body>
    <script src="../helper/common.js"></script>
    <script src="../helper/node.js"></script>
    <script src="../helper/tree.js"></script>
    <script src="../helper/graph.js"></script>
    <script src="../helper/command.js"></script>
    <script>
      // https://leetcode.cn/problems/count-subarrays-where-max-element-appears-at-least-k-times/description/?envType=daily-question&envId=2025-04-29

      // 给你一个整数数组 nums 和一个 正整数 k 。
      // 请你统计有多少满足 「 nums 中的 最大 元素」至少出现 k 次的子数组，并返回满足这一条件的子数组的数目。
      // 子数组是数组中的一个连续元素序列。
      //
      // 提示：
      // 1 <= nums.length <= 105
      // 1 <= nums[i] <= 106
      // 1 <= k <= 105

      var countSubarrays = function (nums = [], k = 1) {};

      // --- answer-1 ---

      // 以right为右边界，左边子数组只要包含k个最大值，那么[0, right]的子数组都满足条件
      // right可以是任一
      var countSubarrays = function (nums = [], k = 1) {
        const n = nums.length;
        const max = Math.max(...nums);
        let ans = 0;
        let left = 0;
        let right = 0;
        let count = 0;
        while (right < n) {
          if (nums[right] === max) {
            count++;
          }
          while (count === k) {
            if (nums[left] === max) {
              count--;
            }
            left++;
          }
          ans += left;
          right++;
        }
        return ans;
      };

      var countSubarrays = function (nums, k) {
        const mx = Math.max(...nums);
        let ans = 0,
          count = 0,
          left = 0;
        for (const x of nums) {
          if (x === mx) {
            count++;
          }
          while (count === k) {
            if (nums[left] === mx) {
              count--;
            }
            left++;
          }
          ans += left;
        }
        return ans;
      };

      // --- answer-1 ---

      // --- answer-2 ---

      // --- answer-2 ---

      // var nums = [1,3,2,3,3], k = 2;
      // var result = 6;
      // 解释：包含元素 3 至少 2 次的子数组为：[1,3,2,3]、[1,3,2,3,3]、[3,2,3]、[3,2,3,3]、[2,3,3] 和 [3,3] 。

      // var nums = [1,4,2,1], k = 3;
      // var result = 0;
      // 解释：没有子数组包含元素 4 至少 3 次。'

      var nums = [61, 23, 38, 23, 56, 40, 82, 56, 82, 82, 82, 70, 8, 69, 8, 7, 19, 14, 58, 42, 82, 10, 82, 78, 15, 82];
      var k = 2;
      var result = 224;

      console.log('nums = ', nums);
      console.log('k = ', k);
      console.log('result = ', result);
      console.log('countSubarrays = ', countSubarrays(nums, k));
    </script>
  </body>
</html>
